# Development Record

## Day 1 — 專案骨架 + 健康檢查 + 端口限制
日期：2025-08-11  
時數：約 2 小時  
狀態：已完成

### 目標
- 以 Docker Compose 建立可啟動的最小骨架：Nginx（反向代理）+ Backend（Flask）+ Frontend（靜態殼）
- 後端提供健康檢查 API：`/api/healthz`
- 簡易維護模式：開啟時除健康檢查外一律回應 503
- 對外僅開 12005 端口，不得使用 80/8000/8080/8081 等 80 系列
- 產出可重現步驟與基礎檔案結構

### 達成情況
- 完成 `docker-compose.yml`，包含 backend、frontend、nginx 三服務
- 後端建立 Flask 應用，實作 `/api/healthz` 與統一錯誤 JSON 格式
- 維護模式開關可透過環境變數啟用
- Nginx 僅對外映射 12005，其他 80 系列端口無法連線
- 前端先以簡單靜態 HTML 殼代替，待後續改為 React + Tailwind
- 驗收測試：健康檢查可用、維護模式正確回 503、端口限制生效

---


## Day 2 — Navbar 完成與多主題系統
日期：2025-08-12  
時數：約 2 小時  
狀態：已完成

### 目標
- 前端基底採用 React + Tailwind
- Navbar 完成三種使用者狀態（未登入、已登入、管理員）不同選單顯示
- 桌面版置中排列，當前頁按鈕加粗與底線提示
- 手機版改為右下角浮動按鈕（FAB）展開選單
- 實作多主題系統：在原米白／灰黑之外新增海霧、森雨、暮霞三種模式
- 每個主題皆支援亮色與暗色版本，並使用 CSS 變數
- 新增主題切換器，記住使用者最後選擇（localStorage）

### 達成情況
- Navbar 桌面置中，選單橫向排列，不會跑版變直立
- 手機版導覽改用右下 FAB，點擊展開選單
- 新增三種主題模式，顏色非純黑白，深色背景避免全黑
- 主題切換器可在所有主題與亮暗模式間即時切換
- 使用者設定會儲存在 localStorage，重新整理仍能保持選擇
- 多主題與亮暗模式的顏色配置已完成並驗收

---

好的，那我會用和 **Day 2** 一樣的格式幫你整理 **Day 3** 的成果紀錄：

---

## Day 3 — 平台模式邏輯優化與回報系統

日期：2025-08-14
時數：約 4 小時
狀態：已完成

### 目標

* 優化平台模式切換邏輯，保留正常模式主頁並分離開發模式頁
* 維護與開發模式沿用現有主題系統，不再額外設定背景
* 維護模式頁面設計美化，資訊集中並支援半透明與毛玻璃效果
* 新增回報表單，回報內容寄送至指定信箱（`zengcode0315@gmail.com`）
* 後端建立 `/api/report` API，接收並轉寄回報
* 在維護模式與開發模式頁面整合回報表單

### 達成情況

* **平台模式優化**

  * `/` 永遠顯示正常模式主頁，即使在開發模式也會保留
  * 開發模式新增 `/dev` 頁面作為測試與預覽區
  * 主頁在開發模式下會顯示提示橫幅並連結至 `/dev`
  * 維護模式與開發模式均沿用現有主題系統，不需額外設定
* **維護模式設計**

  * 半透明卡片式設計，置中顯示維護訊息與完成時間
  * 增加回報表單，方便用戶在維護期間回饋問題
* **回報系統**

  * 前端表單包含 Email（選填）、類別（下拉選單）、問題描述（必填 ≥5 字）
  * 後端 `/api/report` 接口驗證輸入並寄送回報至目標信箱
  * 信件內容附帶使用者資訊（IP、UA、平台模式、Request-ID）
  * 支援環境變數 `REPORT_TO` 覆蓋收件者設定
* **API 安全性**

  * 維護模式下，除 `/api/mode`、`/api/healthz`、`/api/report` 外的 API 一律返回 503 狀態
  * 全域錯誤處理器統一格式，附帶請求追蹤資訊

---

## Day 5 — 基礎登入/權限與後台

日期：2025-08-15
時數：約 2 小時
狀態：已完成

### 目標

* 建立最小可用的**身分與權限**：未登入 / 已登入 / 管理員（Admin）。
* 讓 **/mode**（平台模式管理）只允許管理員操作；一般使用者看到引導訊息。
* 打好安全底座：**HttpOnly Cookie**、**同源 CORS 收斂**、**登入節流（rate limit）**、**密碼雜湊**、**CSRF 基礎**。
* 前端補上**登入流程與狀態切換**，將原本「登入圖示」→「設定圖示」的 UI 規則串接後端。
* 保留你既有的主題系統與模式頁邏輯，不影響 Day 1–Day 4 的成果。

---

### 達成情況

1. **後端（Flask）**

   * `auth` 路由組

     * `POST /api/auth/login`：表單或 JSON 帳密登入，成功後簽發 **HttpOnly、SameSite=Lax** 的 `session` Cookie。
     * `POST /api/auth/logout`：清除 Cookie。
     * `GET /api/auth/me`：回傳目前使用者狀態（guest/user/admin），供前端初始化。
   * **管理員初始化**

     * 以環境變數 `ADMIN_USERNAME`、`ADMIN_PASSWORD` 設定唯一管理員；密碼以 **bcrypt** 雜湊存放（目前暫存於檔案或記憶體，Day 6 將遷移 DB）。
   * **權限中介層**

     * `/api/mode`：改為**必須 Admin** 才能 `POST`；`GET` 仍開放（維護期間要看得到）。
     * `/api/report` 與 `/api/color_vote` 照常開放（維護期間亦允許，符合 Day 4 行為）。
   * **Rate limit**

     * 登入端點加入簡易節流：同 IP 多次失敗會短暫阻擋，遏止暴力猜測。
   * **CSRF 基礎**

     * 新增 `GET /api/auth/csrf` 發 CSRF token（亦可回傳在 `me`），前端送表單時夾帶 `X-CSRF-Token`。
   * **CORS/Headers 收斂**

     * 僅允許前端來源（Nginx 站點）呼叫 `/api/*`；保留必要的 `X-Request-ID`、`X-ForumKit-*` 標頭。

2. **前端（React）**

   * **全域狀態**：App 啟動時呼叫 `/api/auth/me`，決定 Navbar 顯示（未登入→登入圖示；已登入→設定圖示）。
   * **登入介面**：提供一個最小化登入面板（可彈窗或獨立頁），成功後自動刷新身分狀態。
   * **/mode 守門**：

     * 未登入或非管理員：顯示「需管理員權限」提示與「去登入」按鈕。
     * 管理員：正常顯示 Day 4 的模式切換 UI；**儲存後直接跳回首頁**（修掉你 Day 4 反映的行為）。
   * **表單可重複提交**：針對你回報「寫一次就不能再送」的情況，標準化送出後的狀態清理（重置 `busy/submitted` 與欄位），確保可再次提交。

3. **Nginx（前端容器）**

   * 無需調整反代規則；但將 `add_header` 收斂以配合 Cookie（保留 `SameSite=Lax` 預設行為即可）。

4. **Docker Compose（環境變數）**

   * 新增：

     * `ADMIN_USERNAME`、`ADMIN_PASSWORD`（管理員憑證）
     * `JWT_SECRET_KEY`（若後續要支援 JWT；目前以 Session 為主）
     * `FORUMKIT_DEBUG=0/1`（錯誤訊息詳細度控制）
   * 未對外暴露 Backend 連接埠，仍由 Nginx 反代 12005 總入口。

---
