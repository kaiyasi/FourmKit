# Instagram 整合管理頁面改進

## 概述

本次改進針對 Instagram 整合管理頁面進行了多項優化，提升了用戶體驗和管理效率。

## 主要改進

### 1. 帳號管理功能增強

#### ✅ 新增功能
- **刪除帳號**: 添加了刪除 Instagram 帳號的功能
- **編輯帳號**: 支持編輯現有帳號的所有資訊
- **權限控制**: 只有 `dev_admin` 可以刪除和編輯帳號

#### 🔧 技術實現
- 前端：添加刪除和編輯按鈕，實現確認對話框
- 後端：新增 `DELETE /api/admin/instagram/accounts/<id>` API
- 安全檢查：刪除前檢查是否有相關發布記錄

### 2. 學校選擇優化

#### ✅ 改進內容
- **學校選單**: 將學校 ID 輸入框改為下拉選單
- **權限控制**: 
  - `dev_admin`: 可以選擇所有學校
  - 其他角色: 只能選擇對應身份的學校
- **直觀顯示**: 顯示學校名稱而非 ID

#### 🔧 技術實現
- 前端：使用 `<select>` 替代 `<input type="number">`
- 動態載入：從 `/api/schools` 獲取學校列表
- 權限過濾：根據用戶角色顯示對應學校選項

### 3. 欄位優化

#### ✅ 改進內容
- **移除頁面 ID**: 移除了不必要的頁面 ID 欄位
- **重命名欄位**: 將 "Instagram 用戶 ID" 改為 "IG 應用程式密鑰"
- **簡化表單**: 減少必填欄位，提升用戶體驗

#### 🔧 技術實現
- 前端：移除 `page_id` 相關欄位和邏輯
- 後端：更新 API 參數驗證和服務方法
- 資料庫：暫時保留 `page_id` 欄位（設為空字串）

### 4. 用戶界面改進

#### ✅ 改進內容
- **操作按鈕**: 添加編輯、刪除、刷新權杖按鈕
- **視覺反饋**: 刪除按鈕使用紅色樣式
- **確認對話**: 刪除操作前顯示確認對話框
- **狀態指示**: 權杖有效性狀態顯示

#### 🔧 技術實現
- 使用 `Edit`、`Trash2`、`RefreshCw` 圖標
- 實現確認對話框防止誤刪
- 添加適當的 hover 效果和工具提示

## API 變更

### 新增 API
```http
DELETE /api/admin/instagram/accounts/{account_id}
```

### 修改 API
```http
POST /api/admin/instagram/accounts
PATCH /api/admin/instagram/accounts/{account_id}
```

### 參數變更
- 移除 `page_id` 參數
- 重命名 `ig_user_id` 為更直觀的描述
- 添加 `school_id` 到響應數據

## 資料庫影響

### 暫時處理
- `page_id` 欄位保留但設為空字串
- 未來可考慮將此欄位設為可選或移除

### 關聯檢查
- 刪除帳號前檢查 `InstagramPost` 關聯
- 防止有發布記錄的帳號被誤刪

## 權限控制

### 角色權限
- **dev_admin**: 完整權限（創建、編輯、刪除、查看所有學校）
- **campus_admin**: 受限權限（只能管理自己學校的帳號）
- **其他角色**: 無權限

### 學校選擇權限
- **dev_admin**: 可選擇所有學校
- **campus_admin**: 只能選擇自己學校
- **其他角色**: 無權限

## 未來改進建議

### 1. 資料庫優化
- 將 `page_id` 欄位設為可選或完全移除
- 添加帳號刪除的軟刪除選項

### 2. 功能增強
- 添加帳號批量操作功能
- 實現帳號權杖自動刷新
- 添加帳號使用統計和監控

### 3. 用戶體驗
- 添加帳號搜索和篩選功能
- 實現帳號狀態的即時更新
- 添加操作歷史記錄

## 測試建議

### 功能測試
1. 測試創建新帳號（不同學校）
2. 測試編輯帳號資訊
3. 測試刪除帳號（有/無發布記錄）
4. 測試權限控制（不同角色）

### 邊界測試
1. 測試刪除有發布記錄的帳號
2. 測試無權限用戶的操作
3. 測試學校選擇的權限控制

## 部署注意事項

### 後端部署
1. 確保新的 API 端點已正確註冊
2. 檢查權限控制是否正常工作
3. 驗證資料庫關聯檢查邏輯

### 前端部署
1. 確保學校列表 API 正常運作
2. 檢查權限控制邏輯
3. 驗證表單驗證和錯誤處理

## 總結

本次改進大幅提升了 Instagram 整合管理頁面的可用性和管理效率：

1. **更直觀的操作**: 學校選單替代 ID 輸入
2. **更完整的功能**: 支持編輯和刪除帳號
3. **更安全的操作**: 添加確認對話框和權限檢查
4. **更簡潔的界面**: 移除不必要的欄位

這些改進讓管理員能夠更輕鬆地管理 Instagram 整合功能，同時確保了系統的安全性和穩定性。
