# ForumKit V1.2.0 - å·¥å–®ç³»çµ±éƒ¨ç½²æŒ‡å—

ğŸ—“ï¸ ç™¼å¸ƒæ—¥æœŸï¼š2025-08-28

## ç‰ˆæœ¬æ¦‚è¿°

æœ¬ç‰ˆèšç„¦ä¼æ¥­ç´šæ”¯æ´å·¥å–®ç³»çµ±çš„è¨­è¨ˆã€éƒ¨ç½²èˆ‡é©—è­‰ï¼›è©³è¦‹ä¸‹æ–‡å„ç¯€ã€‚

## ä¸»è¦åŠŸèƒ½

- å®¢æœæ”¯æ´ç³»çµ±ï¼šå®Œæ•´ç‹€æ…‹æ©Ÿã€äº‹ä»¶å¯©è¨ˆã€æŒ‡æ´¾èˆ‡æ¨™ç±¤ç®¡ç†ã€‚
- Mobile-first ä»‹é¢ï¼šè¡Œå‹•ç«¯ä¸‰åˆä¸€ï¼ˆå»ºç«‹/è¿½è¹¤/æ­·å²ï¼‰èˆ‡è§¸æ§å„ªåŒ–ã€‚
- é›™é‡èº«ä»½æ”¯æ´ï¼šç™»å…¥ç”¨æˆ¶èˆ‡è¨ªå®¢çš†å¯å»ºç«‹ã€è¿½è¹¤ã€å›è¦†ï¼ˆHMAC è¿½è¹¤ï¼‰ã€‚
- å³æ™‚é€šè¨Šæ•´åˆï¼šæˆ¿é–“æ©Ÿåˆ¶ã€typing æŒ‡ç¤ºã€æ–·ç·šé‡é€£ã€äº‹ä»¶å»£æ’­ã€‚
- é€šçŸ¥ç³»çµ±ï¼šHTML éƒµä»¶æ¨¡æ¿ã€å¤šå ´æ™¯é€šçŸ¥ã€ç°½ç« é€£çµèˆ‡ç·šç¨‹è¿½è¹¤ã€‚
- å®‰å…¨èˆ‡æ¿«ç”¨é˜²è­·ï¼šèœ‚èœœç½ã€åƒåœ¾éæ¿¾ã€é€Ÿç‡é™åˆ¶ã€ç›¸ä¼¼å…§å®¹æª¢æ¸¬ã€‚
- ç®¡ç†å·¥å…·ï¼šé€²éšæœå°‹ã€æ‰¹æ¬¡æ“ä½œã€SLA è­¦ç¤ºã€å·¥ä½œè² è¼‰çµ±è¨ˆã€‚

## ç‰¹è‰²

- å®Œæ•´ç”Ÿå‘½é€±æœŸï¼šopen â†’ awaiting_user/admin â†’ resolved â†’ closed â†’ reopenedã€‚
- è¨ªå®¢å®‰å…¨è¿½è¹¤ï¼šHMAC ç°½ç« èˆ‡è¿½è¹¤ç¢¼ï¼Œç„¡éœ€ç™»å…¥äº¦å¯æŸ¥è©¢ã€‚
- å¼·éŸŒå³æ™‚é«”é©—ï¼šSocket.IO æˆ¿é–“/é‡é€£/å»£æ’­è·¯å¾‘è¦†è“‹å¸¸è¦‹å ´æ™¯ã€‚
- å°ˆæ¥­ç´šé€šçŸ¥ï¼šHTML æ¨¡æ¿ã€ç·šç¨‹è¿½è¹¤ã€å¤±æ•—é‡è©¦èˆ‡éŒ¯èª¤è¿½è¹¤ã€‚
- åˆ†æèˆ‡æ²»ç†ï¼šè§£æ±ºç‡ã€å„ªå…ˆç´šåˆ†å¸ƒã€åˆ†é¡èˆ‡æ™‚æ•ˆæ€§çµ±è¨ˆã€‚

## æ•™å­¸èªªæ˜

- åƒè€ƒã€Œç’°å¢ƒè®Šæ•¸ã€ã€Œéƒ¨ç½²æ­¥é©Ÿã€ç« ç¯€è¨­å®šä¸¦å•Ÿå‹•ç³»çµ±ï¼š
  ```bash
  docker compose up -d --build
  ```
- ä½¿ç”¨è¡Œå‹•ç«¯æ”¯æ´é å»ºç«‹å·¥å–®ï¼Œæ–¼ç®¡ç†å¾Œå°å›è¦†ä¸¦é©—è­‰å³æ™‚åŒæ­¥ã€‚
- æ¸¬è©¦è¨ªå®¢è¿½è¹¤ç¢¼ç™»å…¥ï¼Œé©—è­‰ç°½ç« é€£çµèˆ‡ç‹€æ…‹æŸ¥è©¢ã€‚

> **é‡å¤§æ›´æ–°ï¼šå¾ç°¡å–®å›å ±ç³»çµ±å‡ç´šç‚ºå®Œæ•´å·¥å–®ç®¡ç†ç³»çµ±**

## ğŸ“‹ æ›´æ–°æ¦‚è¦

V1.2.0 ç‰ˆæœ¬å°‡åŸæœ¬çš„ç°¡å–®æ”¯æ´å›å ±ç³»çµ±å®Œå…¨é‡æ–°è¨­è¨ˆç‚ºä¼æ¥­ç´šå·¥å–®ç®¡ç†ç³»çµ±ï¼Œæä¾›ï¼š

- âœ… å®Œæ•´å·¥å–®ç”Ÿå‘½é€±æœŸç®¡ç†
- âœ… æ™ºæ…§è¿½è¹¤ç¢¼ç³»çµ±  
- âœ… æ‰‹æ©Ÿå„ªå…ˆçš„ç”¨æˆ¶ç•Œé¢
- âœ… ç®¡ç†å“¡åˆ†ç´šæ¬Šé™
- âœ… è±å¯Œçš„æ­·å²è¨˜éŒ„

---

## ğŸ—„ï¸ æ•¸æ“šåº«é·ç§»

### æ–°å¢è¡¨æ ¼
æ­¤æ¬¡æ›´æ–°å°‡å‰µå»ºä»¥ä¸‹æ–°è¡¨æ ¼ï¼š

```sql
-- å·¥å–®ä¸»è¡¨
support_tickets
-- å·¥å–®å›è¦†è¡¨  
ticket_responses
-- å·¥å–®é™„ä»¶è¡¨
ticket_attachments
-- å·¥å–®æ­·å²è¡¨
ticket_history
-- ç”¨æˆ¶è­˜åˆ¥ç¢¼è¡¨
user_identity_codes
```

### åŸ·è¡Œé·ç§»

```bash
# åœ¨ Docker ç’°å¢ƒä¸­åŸ·è¡Œ
docker-compose exec backend alembic upgrade head

# æˆ–è€…åœ¨é–‹ç™¼ç’°å¢ƒä¸­
cd backend
python -m alembic upgrade head
```

---

## ğŸ”§ éƒ¨ç½²æ­¥é©Ÿ

### 1. å‚™ä»½ç¾æœ‰æ•¸æ“šï¼ˆé‡è¦ï¼ï¼‰

```bash
# å‚™ä»½æ•¸æ“šåº«
docker-compose exec postgres pg_dump -U forumkit forumkit > forumkit_backup_$(date +%Y%m%d).sql

# å‚™ä»½ä¸Šå‚³æ–‡ä»¶
cp -r uploads uploads_backup_$(date +%Y%m%d)
```

### 2. æ‹‰å–æœ€æ–°ä»£ç¢¼

```bash
git pull origin main
# ç¢ºä¿æ‚¨åœ¨ V1.1.6 ç‰ˆæœ¬
git checkout v1.1.6
```

### 3. é‡å»ºæ‡‰ç”¨

```bash
# åœæ­¢æœå‹™
docker-compose down

# é‡å»ºä¸¦å•Ÿå‹•
docker-compose up --build -d

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps
```

### 4. åŸ·è¡Œæ•¸æ“šåº«é·ç§»

```bash
# ç­‰å¾…æ•¸æ“šåº«å®Œå…¨å•Ÿå‹•
sleep 10

# åŸ·è¡Œé·ç§»
docker-compose exec backend alembic upgrade head
```

### 5. é©—è­‰éƒ¨ç½²

```bash
# æª¢æŸ¥å¥åº·ç‹€æ…‹
curl http://localhost:12005/api/healthz

# æª¢æŸ¥å·¥å–®ç³»çµ±API
curl http://localhost:12005/api/support/recent
```

---

## ğŸ“± æ–°åŠŸèƒ½èªªæ˜

### ç”¨æˆ¶ç«¯åŠŸèƒ½

#### 1. å·¥å–®æäº¤
- **è·¯å¾‘**: `/support`
- **åŠŸèƒ½**: æäº¤æ–°å·¥å–®ï¼Œæ”¯æ´åœ–ç‰‡é™„ä»¶
- **è¿½è¹¤**: è‡ªå‹•ç”Ÿæˆè¿½è¹¤ç¢¼

#### 2. å·¥å–®è¿½è¹¤  
- **è·¯å¾‘**: `/track`
- **åŠŸèƒ½**: ä½¿ç”¨è¿½è¹¤ç¢¼æŸ¥è©¢å·¥å–®ç‹€æ…‹
- **æ”¯æ´**: åŒ¿åç”¨æˆ¶å’Œå·²ç™»å…¥ç”¨æˆ¶

#### 3. æ‰‹æ©Ÿç‰ˆæ”¯æ´
- **è·¯å¾‘**: `/mobile-support`
- **åŠŸèƒ½**: ä¸‰åˆä¸€ä»‹é¢ï¼ˆæäº¤/è¿½è¹¤/æ­·å²ï¼‰
- **å„ªåŒ–**: è§¸æ§å‹å¥½ï¼ŒéŸ¿æ‡‰å¼è¨­è¨ˆ

### ç®¡ç†å“¡åŠŸèƒ½

#### 1. å·¥å–®ç®¡ç†
- **è·¯å¾‘**: `/admin/support-inbox` 
- **æ¬Šé™**: æ ¹æ“šç®¡ç†å“¡è§’è‰²éæ¿¾å·¥å–®
- **åŠŸèƒ½**: æŸ¥çœ‹ã€å›è¦†ã€æŒ‡æ´¾å·¥å–®

#### 2. APIç«¯é»
```
GET  /api/support/recent     # ç²å–æœ€æ–°å·¥å–®
GET  /api/support/my         # æˆ‘çš„å·¥å–®æ­·å²
POST /api/support/reply      # ç®¡ç†å“¡å›è¦†
GET  /api/support/track/:code # è¿½è¹¤å·¥å–®
```

---

## ğŸ” æ¬Šé™è¨­ç½®

### ç®¡ç†å“¡è§’è‰²èªªæ˜

| è§’è‰² | å¯è™•ç†å·¥å–®ç¯„åœ |
|------|----------------|
| `dev_admin` | æ‰€æœ‰å·¥å–® |
| `cross_admin` | è·¨æ ¡å·¥å–® |
| `campus_admin` | æ‰€å±¬å­¸æ ¡çš„æ ¡å…§å·¥å–® |

### æ¬Šé™é©—è­‰
- ç”¨æˆ¶åªèƒ½æŸ¥çœ‹è‡ªå·±æäº¤çš„å·¥å–®
- ç®¡ç†å“¡æ ¹æ“šè§’è‰²é™åˆ¶å¯è™•ç†çš„å·¥å–®ç¯„åœ
- åŒ¿åç”¨æˆ¶éœ€è¦è¿½è¹¤ç¢¼æ‰èƒ½æŸ¥çœ‹å·¥å–®

---

## ğŸ¨ ç•Œé¢é›†æˆ

### å°èˆªæ›´æ–°
éœ€è¦æ›´æ–°å°èˆªèœå–®ä»¥åŒ…å«æ–°çš„å·¥å–®åŠŸèƒ½ï¼š

```typescript
// åœ¨å°èˆªçµ„ä»¶ä¸­æ·»åŠ 
{
  name: 'å®¢æœæ”¯æ´',
  href: '/support',
  icon: MessageSquare
}
```

### è·¯ç”±é…ç½®
ç¢ºä¿ä»¥ä¸‹è·¯ç”±æ­£ç¢ºé…ç½®ï¼š

```typescript
// React Router è·¯ç”±
{
  path: '/support',
  element: <SupportPage />
},
{
  path: '/track',
  element: <TicketTrackPage />  
},
{
  path: '/mobile-support',
  element: <MobileSupportPage />
}
```

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. é·ç§»å¤±æ•—
```bash
# æª¢æŸ¥æ•¸æ“šåº«é€£æ¥
docker-compose logs postgres

# æ‰‹å‹•åŸ·è¡Œé·ç§»
docker-compose exec backend alembic current
docker-compose exec backend alembic upgrade head
```

#### 2. å·¥å–®è™Ÿç”ŸæˆéŒ¯èª¤
```bash
# æª¢æŸ¥å·¥å–®è™Ÿç”Ÿæˆå‡½æ•¸
docker-compose exec backend python -c "from utils.ticket import new_ticket_id; print(new_ticket_id())"
```

#### 3. æ¬Šé™å•é¡Œ
```bash
# æª¢æŸ¥ç”¨æˆ¶è§’è‰²
docker-compose exec backend python -c "
from utils.db import get_session
from models import User
with get_session() as s:
    users = s.query(User).filter(User.role.in_(['dev_admin', 'cross_admin', 'campus_admin'])).all()
    for u in users: print(f'{u.username}: {u.role}')
"
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# å¾Œç«¯æ—¥å¿—
docker-compose logs backend -f

# æ•¸æ“šåº«æ—¥å¿—  
docker-compose logs postgres -f
```

---

## ğŸ“Š ç›£æ§å’Œç¶­è­·

### å¥åº·æª¢æŸ¥
```bash
# API å¥åº·æª¢æŸ¥
curl http://localhost:12005/api/healthz

# å·¥å–®ç³»çµ±ç‹€æ…‹
curl http://localhost:12005/api/support/recent \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### æ•¸æ“šåº«ç¶­è­·
```bash
# æŸ¥çœ‹å·¥å–®çµ±è¨ˆ
docker-compose exec postgres psql -U forumkit -d forumkit -c "
SELECT status, COUNT(*) FROM support_tickets GROUP BY status;
"

# æŸ¥çœ‹æœ€è¿‘çš„å·¥å–®
docker-compose exec postgres psql -U forumkit -d forumkit -c "
SELECT ticket_number, subject, status, created_at 
FROM support_tickets 
ORDER BY created_at DESC LIMIT 10;
"
```

---

## ğŸš€ æ€§èƒ½å„ªåŒ–å»ºè­°

### æ•¸æ“šåº«ç´¢å¼•
é·ç§»å·²è‡ªå‹•å‰µå»ºå¿…è¦ç´¢å¼•ï¼ŒåŒ…æ‹¬ï¼š
- `idx_tickets_status_created` - ç‹€æ…‹å’Œå‰µå»ºæ™‚é–“
- `idx_tickets_number` - å·¥å–®è™Ÿç¢¼å”¯ä¸€ç´¢å¼•
- `idx_responses_ticket_created` - å›è¦†æ™‚é–“ç´¢å¼•

### ç·©å­˜ç­–ç•¥
è€ƒæ…®ç‚ºé »ç¹æŸ¥è©¢æ·»åŠ  Redis ç·©å­˜ï¼š
- æœ€è¿‘å·¥å–®åˆ—è¡¨
- ç”¨æˆ¶å·¥å–®çµ±è¨ˆ
- ç‹€æ…‹åˆ†å¸ƒçµ±è¨ˆ

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœåœ¨éƒ¨ç½²éç¨‹ä¸­é‡åˆ°å•é¡Œï¼š

1. **æª¢æŸ¥æ—¥å¿—**: `docker-compose logs backend`
2. **é©—è­‰æ•¸æ“šåº«**: ç¢ºä¿æ‰€æœ‰æ–°è¡¨æ ¼å·²å‰µå»º
3. **æ¸¬è©¦API**: ä½¿ç”¨ curl æˆ– Postman æ¸¬è©¦ç«¯é»
4. **æª¢æŸ¥æ¬Šé™**: ç¢ºèªç®¡ç†å“¡ç”¨æˆ¶è§’è‰²æ­£ç¢ºè¨­ç½®

---

*ğŸ“… æœ€å¾Œæ›´æ–°ï¼š2025-08-28*
*ğŸ¢ é–‹ç™¼åœ˜éšŠï¼šSerelix Studio*
*ğŸ“§ æŠ€è¡“æ”¯æ´ï¼šé€éå¹³å°å…§å»ºæ”¯æ´ç³»çµ±*

---
