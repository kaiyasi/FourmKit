# 🧭 ForumKit V1.1.0 大版本更新介紹

> 強化事件中心與管理後台體驗，統一跨平台搜尋/篩選行為，並提升穩定性與錯誤回饋。

## 📋 更新概要

- 事件中心 × 通知：Discord Webhook 與內部事件流統一記錄
- 後台體驗升級：管理員聊天室、自訂房間、學校設定權限更清晰
- 前後端穩定性：Nginx 5xx 錯誤頁、Socket.IO 綁定與可調整限流、SQLAlchemy 命名衝突修正
- 桌面/手機搜尋一致：學校/跨校/全部 的選擇邏輯與參數統一

---

## 🛠 重要變更詳解

### 1) 事件中心與通知整合
- Discord Webhook 成功送出後，同步記錄至內部事件（`ADMIN_NOTIFY_LOG_EVENTS` 可控制）。
- 後台事件統計欄位對齊前端期望鍵名，避免 `undefined` 造成的渲染錯誤。

### 2) 管理員聊天室升級
- 新增「自訂聊天室」：僅 `dev_admin` 可建立、刪除、加入/移除成員。
- 加入房間時以 JWT 綁定使用者（`username/role/school_id`），訊息與線上清單顯示正確名稱。
- 自訂聊天室 ACL：僅 `dev_admin` 或在房間成員名單中的使用者可加入。

### 3) 搜尋/瀏覽範圍統一（桌面 × 手機）
- `__ALL__` 代表全部學校 → `all_schools=true`
- 空字串 `''` 代表跨校 → `cross_only=true`
- 其他字串 → 指定學校 `school=<slug>`
- 修正跨校檢視只回跨校貼文（不再混入校內貼文）。

### 4) 學校設定與權限調整
- 僅 `dev_admin` 可編輯學校設定；`campus_moderator`/`campus_admin` 改為唯讀並顯示明確提示。
- 前端路由守衛與頁面權限提示同步更新。

### 5) UX / 視覺
- 後台主控台卡片樣式統一（以標籤 class 控制，不固定高度）。
- 手機版貼文列表修正空清單下「0」誤顯示。

---

## 🔧 穩定性與基礎建設
- SQLAlchemy 保留字衝突修正：將模型屬性 `metadata` 更名為 `metadata_json`（資料庫欄位仍為 `metadata`）。
- Socket.IO 限流支援環境變數調整：`WS_JOIN_*`、`WS_MSG_*`。
- Nginx 5xx 錯誤頁優化：
  - 友善文案與導向（重試/登入/首頁）
  - 自動倒數重試

---

## 🚀 部署建議
- 無破壞性資料庫變更；不需新 migration。
- 建議重建前後端容器以套用新的 Nginx 錯誤頁與環境變數。

---

## 🧪 驗收建議清單
- 事件中心：觸發一筆 Discord Webhook，確認內部事件同步寫入。
- 管理員聊天室：
  - 以 `dev_admin` 建立自訂房間，測試加入/移除成員、刪除房間
  - 一般管理員加入不在名單的自訂房間應被拒（ACL 生效）
- 貼文瀏覽：桌面/手機切換「全部 / 跨校 / 指定學校」行為一致。
- 學校設定：`dev_admin` 可寫入；校內角色改為唯讀。

---

## 📎 相關環境變數（節錄）
- `ADMIN_NOTIFY_LOG_EVENTS`：Webhook 成功後是否同步記錄事件（預設開啟）
- `WS_JOIN_CALLS`、`WS_JOIN_WINDOW`：房間加入限流
- `WS_MSG_CALLS_PER_CLIENT`、`WS_MSG_CALLS_PER_SID`、`WS_MSG_WINDOW`：訊息發送限流

---

## 📱 介面與路由（節錄）
- 貼文列表：`/boards`（桌面/手機自適配）。
- 管理員聊天室：`/admin/chat`（自訂房間操作僅 `dev_admin` 顯示）。

---

*📅 最後更新：2025-08-27*
*🏢 開發團隊：Serelix Studio*
*📧 技術支援：透過平台內建支援系統*

---
